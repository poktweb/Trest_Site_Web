# Script de migra√ß√£o: JSON para SQLite
# Este script importa os dados dos arquivos JSON para o banco de dados SQLite

–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ DB –∏–∑–º–æ–¥—É–ª—è "std/database"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ FileSystem –∏–∑–º–æ–¥—É–ª—è "std/filesystem"
–∏–º–ø–æ—Ä—Ç * –∫–∞–∫ JSON –∏–∑–º–æ–¥—É–ª—è "std/json"

–ø–µ—á–∞—Ç—å("üîÑ Iniciando migra√ß√£o de JSON para SQLite...")

# Abrir conex√£o com banco de dados
–ø—É—Å—Ç—å db = DB.–æ—Ç–∫—Ä—ã—Ç—å–ë–î("data/site.db")

–ø–µ—á–∞—Ç—å("‚úÖ Banco de dados aberto: data/site.db")

# Criar tabela de usu√°rios
–ø–µ—á–∞—Ç—å("üìã Criando tabela 'users'...")
db.execute("CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL
)")

# Criar tabela de coment√°rios
–ø–µ—á–∞—Ç—å("üìã Criando tabela 'comments'...")
db.execute("CREATE TABLE IF NOT EXISTS comments (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    text TEXT NOT NULL,
    date INTEGER NOT NULL
)")

–ø–µ—á–∞—Ç—å("‚úÖ Tabelas criadas com sucesso!")

# Migrar usu√°rios
–ø–µ—á–∞—Ç—å("")
–ø–µ—á–∞—Ç—å("üë• Migrando usu√°rios de data/users.json...")
–ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
    –µ—Å–ª–∏ (FileSystem.exists("data/users.json")) {
        –ø—É—Å—Ç—å conteudo = FileSystem.readFile("data/users.json")
        –µ—Å–ª–∏ (conteudo != "" && conteudo != –Ω—É–ª—å) {
            –ø—É—Å—Ç—å users = JSON.parse(conteudo)
            –ø—É—Å—Ç—å count = 0
            –¥–ª—è (–ø—É—Å—Ç—å user –∏–∑ users) {
                –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
                    db.execute("INSERT OR IGNORE INTO users (username, password) VALUES (?, ?)", 
                        [user.username, user.password])
                    count = count + 1
                } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
                    –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Erro ao inserir usu√°rio " + user.username + ": " + erro)
                }
            }
            –ø–µ—á–∞—Ç—å("‚úÖ " + count + " usu√°rio(s) migrado(s)")
        } –∏–Ω–∞—á–µ {
            –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Arquivo users.json est√° vazio")
        }
    } –∏–Ω–∞—á–µ {
        –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Arquivo data/users.json n√£o encontrado, criando usu√°rio padr√£o...")
        db.execute("INSERT OR IGNORE INTO users (username, password) VALUES (?, ?)", 
            ["poktweb", "84005787"])
        –ø–µ—á–∞—Ç—å("‚úÖ Usu√°rio padr√£o criado")
    }
} –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
    –ø–µ—á–∞—Ç—å("‚ùå Erro ao migrar usu√°rios: " + erro)
}

# Migrar coment√°rios
–ø–µ—á–∞—Ç—å("")
–ø–µ—á–∞—Ç—å("üí¨ Migrando coment√°rios de data/comments.json...")
–ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
    –µ—Å–ª–∏ (FileSystem.exists("data/comments.json")) {
        –ø—É—Å—Ç—å conteudo = FileSystem.readFile("data/comments.json")
        –µ—Å–ª–∏ (conteudo != "" && conteudo != –Ω—É–ª—å) {
            –ø—É—Å—Ç—å comments = JSON.parse(conteudo)
            –ø—É—Å—Ç—å count = 0
            –¥–ª—è (–ø—É—Å—Ç—å comment –∏–∑ comments) {
                –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è {
                    db.execute("INSERT OR IGNORE INTO comments (id, name, text, date) VALUES (?, ?, ?, ?)", 
                        [comment.id, comment.name, comment.text, comment.date])
                    count = count + 1
                } –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
                    –ø–µ—á–∞—Ç—å("‚ö†Ô∏è Erro ao inserir coment√°rio " + comment.id + ": " + erro)
                }
            }
            –ø–µ—á–∞—Ç—å("‚úÖ " + count + " coment√°rio(s) migrado(s)")
        } –∏–Ω–∞—á–µ {
            –ø–µ—á–∞—Ç—å("‚ÑπÔ∏è Arquivo comments.json est√° vazio (nenhum coment√°rio para migrar)")
        }
    } –∏–Ω–∞—á–µ {
        –ø–µ—á–∞—Ç—å("‚ÑπÔ∏è Arquivo data/comments.json n√£o encontrado (nenhum coment√°rio para migrar)")
    }
} –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å (erro) {
    –ø–µ—á–∞—Ç—å("‚ùå Erro ao migrar coment√°rios: " + erro)
}

# Verificar dados migrados
–ø–µ—á–∞—Ç—å("")
–ø–µ—á–∞—Ç—å("üìä Verificando dados migrados...")
–ø—É—Å—Ç—å usersCount = db.query("SELECT COUNT(*) as count FROM users")
–ø—É—Å—Ç—å commentsCount = db.query("SELECT COUNT(*) as count FROM comments")

–ø–µ—á–∞—Ç—å("üë• Usu√°rios no banco: " + usersCount[0].count)
–ø–µ—á–∞—Ç—å("üí¨ Coment√°rios no banco: " + commentsCount[0].count)

# Fechar conex√£o
db.close()

–ø–µ—á–∞—Ç—å("")
–ø–µ—á–∞—Ç—å("‚úÖ Migra√ß√£o conclu√≠da com sucesso!")
–ø–µ—á–∞—Ç—å("üìÅ Banco de dados criado em: data/site.db")
